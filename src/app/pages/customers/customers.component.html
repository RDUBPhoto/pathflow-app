<ion-header class="glass-header">
  <ion-toolbar>
    <ion-title>Customers</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding glass-bg">
  <div style="display:grid; gap:10px; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); margin-bottom:14px;">
    <ion-item>
      <ion-label position="stacked">Name</ion-label>
      <ion-input
        [ngModel]="name()"
        (ngModelChange)="name.set($event)"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Phone</ion-label>
      <ion-input
        [ngModel]="phone()"
        (ngModelChange)="phone.set($event)"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Email</ion-label>
      <ion-input
        [ngModel]="email()"
        (ngModelChange)="email.set($event)"></ion-input>
    </ion-item>

    <div style="display:flex; align-items:end;">
      <ion-button (click)="add()">Add</ion-button>
    </div>
  </div>

  <div style="margin-bottom:8px;">{{ status() }}</div>

  <ion-list>
    <ion-item *ngIf="loading()">Loading…</ion-item>
    <ion-item *ngFor="let c of customers()">
      <ion-label class="ion-text-wrap">
        <div class="c-name">{{ c.name }}</div>
        <div class="c-meta">{{ c.phone || '—' }} • {{ c.email || '—' }}</div>
        <div class="veh-title">Vehicles</div>
        <ng-container *ngIf="vehiclesByCustomer()[c.id]?.length; else noVehicles">
          <div class="veh-row">
            <div class="veh-chip" *ngFor="let v of vehiclesByCustomer()[c.id]">
              <span class="veh-swatch" [style.background]="v.color || '#e0e0e0'"></span>
              <span class="veh-name">{{ v.name }}</span>
            </div>
          </div>
        </ng-container>
        <ng-template #noVehicles>
          <div class="veh-none">—</div>
        </ng-template>
      </ion-label>
    </ion-item>
  </ion-list>
</ion-content>
